# TUI界面用户使用指南

## 快速开始

### 启动TUI界面

```bash
# 使用命令行启动
python -m src.presentation.cli.main run

# 或者使用TUI模式
python -m src.presentation.cli.main run --workflow example.yaml --tui
```

### 界面概览

启动后，您将看到简洁的主界面：

```
+---------------------------------------+
|        模化代理框架 - TUI界面          |
+-------------------+-------------------+
| 📊 状态概览       |    欢迎使用...     |
| 🤖 Agent: 默认    |                   |
| 模型: gpt-3.5-turbo |                   |
| 状态: 就绪         |                   |
| 🔄 工作流: 未加载   |                   |
| 状态: 停止         |                   |
| 📈 指标            |                   |
| 消息: 0           |                   |
| Token: 0          |                   |
| 成本: $0.0000     |                   |
| 时长: 0:00        |                   |
+-------------------+-------------------+
| > 在此输入消息... (使用 /help 查看命令) |
+---------------------------------------+
| 快捷键: Alt+1=分析, Alt+2=可视化, Alt+3=系统, Alt+4=错误, ESC=返回 | 状态: 就绪 |
+---------------------------------------+
```

## 基本操作

### 对话交互

1. **输入消息**
   - 在底部输入面板中输入您的消息
   - 按 `Enter` 发送消息
   - 支持多行输入（`Shift+Enter` 换行）

2. **查看对话历史**
   - 主内容区显示完整的对话历史
   - 支持滚动查看历史消息
   - 自动保存对话记录

### 命令系统

输入 `/help` 查看所有可用命令：

```
可用命令:
  /help - 显示帮助
  /clear - 清空屏幕
  /exit - 退出应用
  /save - 保存会话
  /load <session_id> - 加载会话
  /new - 创建新会话
  /pause - 暂停工作流
  /resume - 恢复工作流
  /stop - 停止工作流
  /studio - 打开系统管理界面
  /sessions - 打开会话管理
  /agents - 打开Agent选择
  /performance - 打开分析监控界面
  /debug - 打开可视化调试界面
  /errors - 打开错误反馈界面
  /main - 返回主界面

子界面命令:
  /analytics - 打开分析监控界面
  /visualization - 打开可视化调试界面
  /system - 打开系统管理界面
  /errors - 打开错误反馈界面
  /main - 返回主界面

快捷键:
  Alt+1 - 分析监控
  Alt+2 - 可视化调试
  Alt+3 - 系统管理
  Alt+4 - 错误反馈
  ESC - 返回主界面
```

## 子界面使用

### 1. 分析监控界面 (Alt+1)

**访问方式**：
- 快捷键：`Alt+1`
- 命令：`/analytics` 或 `/performance`

**功能特性**：
- 📊 **性能概览**：显示请求总数、响应时间、成功率等
- 🖥️ **系统指标**：CPU、内存、磁盘使用率监控
- 📜 **执行历史**：查看最近的操作记录和执行时间

**使用技巧**：
- 按 `R` 刷新数据
- 按 `ESC` 返回主界面
- 数据自动更新（可配置）

### 2. 可视化调试界面 (Alt+2)

**访问方式**：
- 快捷键：`Alt+2`
- 命令：`/visualization` 或 `/debug`

**功能特性**：
- 🔄 **工作流可视化**：树形显示工作流结构和节点状态
- 🐛 **节点调试**：查看选中节点的输入、输出和元数据
- 🛤️ **执行路径**：追踪工作流执行过程和耗时

**使用技巧**：
- 按 `D` 切换详细信息显示
- 按 `P` 切换执行路径显示
- 按 `R` 刷新工作流数据
- 点击节点查看详细信息

### 3. 系统管理界面 (Alt+3)

**访问方式**：
- 快捷键：`Alt+3`
- 命令：`/system` 或 `/studio`

**功能特性**：
- 🎬 **Studio管理**：启动/停止LangGraph Studio服务器
- 🔌 **端口配置**：管理各种服务的端口设置
- 📄 **配置管理**：重载配置、查看配置文件
- 💻 **系统信息**：查看Python版本、框架版本等

**使用技巧**：
- 按 `S` 启动/停止Studio
- 按 `R` 重载配置
- 按 `A` 切换自动重载
- Studio启动后可通过浏览器访问

### 4. 错误反馈界面 (Alt+4)

**访问方式**：
- 快捷键：`Alt+4`
- 命令：`/errors`

**功能特性**：
- 📋 **错误列表**：按时间顺序显示所有错误
- 🔍 **错误详情**：查看错误的详细信息、堆栈跟踪
- 📊 **错误统计**：分析错误类型和频率
- ⚙️ **反馈设置**：配置错误报告选项

**使用技巧**：
- 按 `R` 刷新错误列表
- 按 `C` 清除已解决的错误
- 按 `A` 切换自动报告
- 选择错误查看详细信息

## 快捷键参考

### 全局快捷键

| 快捷键 | 功能 | 适用范围 |
|--------|------|----------|
| `Alt+1` | 打开分析监控界面 | 全局 |
| `Alt+2` | 打开可视化调试界面 | 全局 |
| `Alt+3` | 打开系统管理界面 | 全局 |
| `Alt+4` | 打开错误反馈界面 | 全局 |
| `ESC` | 返回主界面/关闭对话框 | 全局 |
| `F1` | 显示帮助 | 全局 |

### 子界面快捷键

| 快捷键 | 功能 | 子界面 |
|--------|------|--------|
| `R` | 刷新数据 | 分析监控、可视化调试、错误反馈 |
| `D` | 切换详细信息 | 可视化调试 |
| `P` | 切换执行路径 | 可视化调试 |
| `S` | 启动/停止Studio | 系统管理 |
| `A` | 切换自动重载/报告 | 系统管理、错误反馈 |
| `C` | 清除已解决错误 | 错误反馈 |

## 会话管理

### 创建新会话

```bash
# 使用命令创建
/new

# 或通过会话管理对话框
/sessions
```

### 保存会话

```bash
# 手动保存
/save

# 自动保存（默认启用）
# 会话会在退出时自动保存
```

### 加载会话

```bash
# 加载指定会话
/load session_id

# 通过会话管理对话框选择
/sessions
```

### 会话管理对话框

1. 按 `/sessions` 打开会话管理
2. 查看所有可用会话
3. 选择会话加载或删除
4. 创建新会话

## Agent管理

### 选择Agent

```bash
# 打开Agent选择对话框
/agents

# 查看当前Agent信息
# 信息显示在侧边栏中
```

### Agent配置

1. 按 `/agents` 打开Agent选择
2. 浏览可用的Agent配置
3. 选择合适的Agent
4. 查看Agent详细信息（模型、工具等）

## 工作流管理

### 工作流状态

- **停止**：工作流未运行
- **运行中**：工作流正在执行
- **完成**：工作流执行完成
- **错误**：工作流执行出错

### 工作流控制

```bash
# 暂停工作流
/pause

# 恢复工作流
/resume

# 停止工作流
/stop
```

### 工作流可视化

1. 按 `Alt+2` 打开可视化调试界面
2. 查看工作流结构
3. 监控执行状态
4. 调试节点问题

## 系统管理

### LangGraph Studio

1. 按 `Alt+3` 打开系统管理界面
2. 在Studio管理面板中点击"启动"
3. 等待服务器启动完成
4. 通过浏览器访问显示的URL

### 端口配置

1. 在系统管理界面查看端口配置
2. 修改需要的端口设置
3. 重启相关服务使配置生效

### 配置重载

```bash
# 通过系统管理界面
# 按 Alt+3 → 按 R

# 或通过命令（如果支持）
/reload_config
```

## 错误处理

### 查看错误

1. 按 `Alt+4` 打开错误反馈界面
2. 浏览错误列表
3. 选择错误查看详情
4. 分析错误原因

### 错误反馈

1. 在错误反馈界面配置反馈设置
2. 启用自动报告（可选）
3. 提交错误反馈
4. 跟踪处理状态

### 常见问题

**Q: 界面卡死怎么办？**
A: 按 `Ctrl+C` 强制退出，然后重新启动

**Q: 子界面无法打开？**
A: 检查是否有错误信息，尝试按 `ESC` 返回主界面后重试

**Q: 数据不更新？**
A: 在子界面中按 `R` 手动刷新数据

**Q: Studio无法启动？**
A: 检查端口是否被占用，在系统管理界面修改端口设置

## 性能优化

### 提升响应速度

1. **关闭不必要的功能**
   - 在配置中禁用自动刷新
   - 减少数据点数量

2. **优化界面布局**
   - 调整侧边栏大小
   - 隐藏不需要的面板

3. **清理历史数据**
   - 定期清理旧的会话
   - 清除已解决的错误

### 内存管理

1. **限制数据量**
   - 设置最大历史记录数
   - 限制错误日志数量

2. **定期重启**
   - 长时间使用后重启TUI
   - 清理内存缓存

## 高级功能

### 自定义配置

编辑配置文件来自定义TUI行为：

```yaml
# 子界面配置
subview:
  enabled: true
  auto_refresh: true
  refresh_interval: 1.0
  max_data_points: 100
  
  # 分析监控配置
  analytics_show_details: true
  analytics_show_system_metrics: true
  
  # 可视化调试配置
  visualization_show_details: true
  visualization_auto_refresh: true

# 快捷键配置
shortcuts:
  analytics: "alt+1"
  visualization: "alt+2"
  system: "alt+3"
  errors: "alt+4"
  back: "escape"
```

### 主题定制

```yaml
# 主题配置
theme:
  name: "default"
  primary_color: "blue"
  secondary_color: "green"
  accent_color: "cyan"
  text_color: "white"
  border_style: "round"
```

## 故障排除

### 常见错误

1. **导入错误**
   ```
   ImportError: No module named 'rich'
   ```
   **解决方案**：安装依赖 `pip install rich`

2. **配置错误**
   ```
   ConfigurationError: Invalid config file
   ```
   **解决方案**：检查配置文件语法，删除损坏的配置

3. **权限错误**
   ```
   PermissionError: Access denied
   ```
   **解决方案**：检查文件权限，确保有读写权限

### 调试模式

启用调试模式获取更多信息：

```bash
# 启动时启用调试
python -m src.presentation.cli.main run --verbose

# 或设置环境变量
export TUI_DEBUG=1
python -m src.presentation.cli.main run
```

### 日志查看

日志文件位置：
- Linux/Mac: `~/.modular_agent/logs/`
- Windows: `%APPDATA%\ModularAgent\logs\`

## 联系支持

如果遇到问题或需要帮助：

1. 查看错误反馈界面获取详细错误信息
2. 检查日志文件获取更多上下文
3. 提交错误反馈或联系开发团队

---

*本指南将随着功能更新持续完善，建议定期查看最新版本。*