命令执行：
命令执行结果如果超出一定行数，先由小模型处理，再给大模型

代码搜索：
根据召回+重排的结果+整理最终片段，小模型读取片段及完整文件，判断哪些内容应当交给大模型，文件给出相对路径即可

搜索/看文档：
__

逻辑推理：
识别原子命题，以形式逻辑的形式整理为主析取/合取
自然语言的关系逻辑转3元组


工具：
回滚文件修改工具

提示词：
类型检查、单元测试优先于执行demo/集成测试/e2e测试

injection提示词：用于破限

多种工具调用格式及配套提示词

所有工作流都要给出demo，放在workflow_demo目录中

系统提示词：尽量在项目根目录执行命令，不要cd到别的目录
检查导入时只需要查看文件的头几行【延迟导入除外】

监控：监控启动的终端的pid，实时更新，通过slash命令关闭特定/所有pid，并提供一键关闭脚本

AGENT：scout
用qwen2.5-7b或Qwen/Qwen2.5-Coder-7B-Instruct或THUDM/glm-4-9b-chat【硅基】或GLM-4.5-Flash【Zai】模型根据重排结果、相应文件内容对文件与问题的联系进行分析，输出摘要，
然后把重排结果、摘要汇总给ds-r1-0528-8b，给出最后的摘要。

搜索：
给出多种匹配模式，并根据返回调整(如过滤文档、测试文件)

测试专家：
执行测试文件。如果是原文件的逻辑存在问题，则结束并给出总结，返回给主agent


会话增加fork功能，复制会话信息【只持久化，不必马上打开】


分析：每次更新todo list时都要输出针对该步骤的思考，为后续思考提供上下文


新增hook功能：
输入错误检查与修复：例如任务输成人物。【中文主要是同音，英语主要是拼写错误。只检查用户指令。需要过滤掉命令返回等信息】直接修改即可


代码审计：codeQL/semgrep


输入信息(仅用户输入的语言表达部分，不关注'''块/json/xml等)语病检查


上下文压缩等价于fork


每次响应都要使用工具【除非是专门的分析节点】

文件操作：
记录修改过程，可以通过工具回退
如果修改引入了格式错误，则可以回退到上一次正确的版本

git专注于储存每个session开始前的原始
在git的基础上新增每个修改过的文件的原始状态的持久化存储(需要压缩)，提供回退thread生命周期内对文件的修改的功能

诊断工具：pylance、ts lsp【可以针对文件/目录】

重写文件不要搜索与替换。直接覆盖(override工具)

新增工具：领域知识查询。可以查询特定领域的知识及工具调用指南，作为特定任务下动态导入的上下文


无缝衔接human relay模式。
支持配置每个节点【主要是那些需要干净上下文或不需要完整上下文的】是否使用human relay模式。
例如context7 mcp搜索节点可以设置为human relay模式

增加重构模式。提示词中要求ai始终采用更根本的方式解决问题，不要放任架构问题不管

debug：执行修改前必须先考虑清楚修改的后果，并分析是否有其他的方案。例如类型不符时分别考虑修改哪个文件是更好的选择。

创建todo list后由小模型检查是否符合要求(可以在计划阶段要求llm通过记忆工具写入分析结果，作为上下文)，
任务执行完后由思考大模型验证是否完成了所有的要求

终端工具：
添加可选参数：获取终端输出信息的间隔。过长信息截断。终端信息先由小模型处理，再给大模型


cli实现与tui类似的功能。输入、模型输出、工具调用结果直接在终端输出

cli新增速率预检测，根据provider-llm分级的请求速率(单独设置RPM,TPM)作出检查，
判断当前配置文件中实际使用的控制参数是否会超出限制(可以假定请求间隔)

限制最大轮数时最后几轮提示ai并要求结束任务。也支持添加提醒开始，方便更好的控制对话轮数

完全的流式输出改为按段输出

编写脚本，用于清理从TUI界面复制出来的包含ui特殊字符的文本

新思路：方案审核节点：干净的上下文+修改方案分段后逐段寻找召回片段，仅最终聚合时使用scout小模型，从而保证上下文尽可能独立

结束任务工具：触发hook，用于激活监督节点，避免全局连接节点

代码静态检查：直接使用balck, mypy, isort。如果不存在，要求
semgrep，定义导入顺序等规则

编辑文件工具：diff、search and replace、override、regex【基于正则模式替换】[首次使用返回替换内容预览(ripgrep)，让llm确认，确认后才执行]

undo_edit工具

检查点可以参考ccundo

文件系统工具分析
初级：仅完整读取、从头/从尾读取单个文件+重写文件
中级：
高级：



存档点工具：执行危险操作前自动内联该工具，先存档再执行危险工具调用