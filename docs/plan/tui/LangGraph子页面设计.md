# LangGraphå­é¡µé¢è®¾è®¡æ–‡æ¡£

## åŠŸèƒ½æ¦‚è¿°

LangGraphå­é¡µé¢å°†æä¾›å®Œæ•´çš„LangGraphå·¥ä½œæµè°ƒè¯•å’Œç›‘æ§åŠŸèƒ½ï¼Œå–ä»£å½“å‰åœ¨ä¸»ç•Œé¢å³ä¾§æ˜¾ç¤ºçš„LangGraphé¢æ¿ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å¿«æ·é”®Alt+6å¿«é€Ÿè®¿é—®æ­¤é¡µé¢ã€‚

## ç•Œé¢è®¾è®¡

### å¸ƒå±€ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             æ¨¡å—åŒ–ä»£ç†æ¡†æ¶ - LangGraphè°ƒè¯•                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   å½“å‰èŠ‚ç‚¹      â”‚           æ‰§è¡Œè·¯å¾„                  â”‚  â”‚
â”‚  â”‚                 â”‚                                     â”‚  â”‚
â”‚  â”‚  â–¶ï¸ æ€è€ƒèŠ‚ç‚¹    â”‚  ğŸ“ è¾“å…¥å¤„ç†                       â”‚  â”‚
â”‚  â”‚  è¿è¡Œä¸­ (2.3s)  â”‚  ğŸ“ å·¥å…·è°ƒç”¨                       â”‚  â”‚
â”‚  â”‚                 â”‚  ğŸ“ æ€è€ƒèŠ‚ç‚¹ (å½“å‰)                â”‚  â”‚
â”‚  â”‚  è¾“å…¥: {...}    â”‚  ğŸ“ è¾“å‡ºç”Ÿæˆ                       â”‚  â”‚
â”‚  â”‚  è¾“å‡º: ç­‰å¾…ä¸­   â”‚                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   çŠ¶æ€å¿«ç…§                              â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  {                                                     â”‚  â”‚
â”‚  â”‚    "messages": [...],                                  â”‚  â”‚
â”‚  â”‚    "current_step": "thinking",                         â”‚  â”‚
â”‚  â”‚    "iteration": 3                                      â”‚  â”‚
â”‚  â”‚  }                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   èŠ‚ç‚¹è¯¦æƒ…                              â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  èŠ‚ç‚¹: thinking                                        â”‚  â”‚
â”‚  â”‚  çŠ¶æ€: è¿è¡Œä¸­                                          â”‚  â”‚
â”‚  â”‚  å¼€å§‹æ—¶é—´: 14:30:25                                    â”‚  â”‚
â”‚  â”‚  è¿è¡Œæ—¶é•¿: 2.3s                                        â”‚  â”‚
â”‚  â”‚  è¾“å…¥å‚æ•°: {query: "Hello"}                            â”‚  â”‚
â”‚  â”‚  è¾“å‡ºç»“æœ: ç­‰å¾…ä¸­                                      â”‚  â”‚
â”‚  â”‚  å…ƒæ•°æ®: {attempts: 1, tokens: 150}                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç»„ä»¶è®¾è®¡

### 1. LangGraphSubviewç±»

```python
# src/presentation/tui/subviews/langgraph.py
class LangGraphSubview(BaseSubview):
    """LangGraphè°ƒè¯•å­ç•Œé¢"""
    
    def __init__(self, config: TUIConfig):
        super().__init__(config)
        
        # å½“å‰èŠ‚ç‚¹æ•°æ®
        self.current_node_data = {
            "name": "æœªè¿è¡Œ",
            "status": "idle",
            "start_time": None,
            "duration": 0.0,
            "input": {},
            "output": None,
            "metadata": {}
        }
        
        # æ‰§è¡Œè·¯å¾„
        self.execution_path: List[Dict[str, Any]] = []
        
        # çŠ¶æ€å¿«ç…§
        self.state_snapshot: Dict[str, Any] = {}
        
        # èŠ‚ç‚¹è¯¦æƒ…
        self.node_details: Dict[str, Any] = {}
        
        # å¯è§†åŒ–è®¾ç½®
        self.visualization_settings = {
            "show_input": True,
            "show_output": True,
            "show_metadata": True,
            "auto_refresh": True,
            "refresh_interval": 1.0
        }
    
    def get_title(self) -> str:
        """è·å–å­ç•Œé¢æ ‡é¢˜"""
        return "ğŸ” LangGraphè°ƒè¯•"
    
    def render(self) -> Panel:
        """æ¸²æŸ“LangGraphç•Œé¢"""
        # åˆ›å»ºä¸»è¦å†…å®¹åŒºåŸŸ
        content = self._create_main_content()
        
        return Panel(
            content,
            title=self.create_header(),
            border_style="cyan",
            subtitle=self.create_help_text()
        )
    
    def _create_main_content(self) -> Layout:
        """åˆ›å»ºä¸»è¦å†…å®¹"""
        from rich.layout import Layout
        
        layout = Layout()
        
        # ç¬¬ä¸€è¡Œï¼šå½“å‰èŠ‚ç‚¹å’Œæ‰§è¡Œè·¯å¾„
        top_row = Layout()
        top_row.split_row(
            Layout(self._create_current_node_panel(), size=30),
            Layout(self._create_execution_path_panel())
        )
        
        # ç¬¬äºŒè¡Œï¼šçŠ¶æ€å¿«ç…§å’ŒèŠ‚ç‚¹è¯¦æƒ…
        bottom_row = Layout()
        bottom_row.split_row(
            Layout(self._create_snapshot_panel()),
            Layout(self._create_node_details_panel(), size=35)
        )
        
        # å‚ç›´ç»„åˆ
        layout.split_column(
            Layout(top_row),
            Layout(bottom_row)
        )
        
        return layout
    
    def _create_current_node_panel(self) -> Panel:
        """åˆ›å»ºå½“å‰èŠ‚ç‚¹é¢æ¿"""
        table = Table(show_header=True, header_style="bold cyan")
        table.add_column("å½“å‰èŠ‚ç‚¹", style="bold")
        table.add_column("çŠ¶æ€", justify="center")
        
        node = self.current_node_data
        
        # çŠ¶æ€æŒ‡ç¤ºå™¨
        status_indicators = {
            "idle": ("â¸ï¸", "dim"),
            "running": ("â–¶ï¸", "green"),
            "completed": ("âœ…", "blue"),
            "error": ("âŒ", "red"),
            "paused": ("â¸ï¸", "yellow")
        }
        
        indicator, color = status_indicators.get(node["status"], ("â“", "white"))
        
        table.add_row(
            Text(node["name"], style=f"bold {color}"),
            Text(f"{indicator} {node['status']}", style=color)
        )
        
        # è¿è¡Œæ—¶é—´
        if node["status"] == "running" and node["duration"] > 0:
            table.add_row("è¿è¡Œæ—¶é—´", f"{node['duration']:.1f}s")
        
        # è¾“å…¥æ•°æ®
        if self.visualization_settings["show_input"] and node["input"]:
            input_preview = self._preview_data(node["input"])
            table.add_row("è¾“å…¥", input_preview)
        
        # è¾“å‡ºæ•°æ®
        if self.visualization_settings["show_output"] and node["output"] is not None:
            output_preview = self._preview_data(node["output"])
            table.add_row("è¾“å‡º", output_preview)
        
        return Panel(
            table,
            title="ğŸ¯ å½“å‰èŠ‚ç‚¹",
            border_style="green"
        )
    
    def _create_execution_path_panel(self) -> Panel:
        """åˆ›å»ºæ‰§è¡Œè·¯å¾„é¢æ¿"""
        tree = Tree("ğŸ“‹ æ‰§è¡Œè·¯å¾„")
        
        for i, step in enumerate(self.execution_path):
            node_name = step.get("node", "æœªçŸ¥èŠ‚ç‚¹")
            status = step.get("status", "completed")
            duration = step.get("duration", 0.0)
            
            # çŠ¶æ€æ ·å¼
            status_styles = {
                "completed": ("âœ…", "green"),
                "running": ("â–¶ï¸", "yellow"),
                "error": ("âŒ", "red"),
                "pending": ("â³", "dim")
            }
            
            indicator, color = status_styles.get(status, ("â“", "white"))
            
            # åˆ›å»ºèŠ‚ç‚¹æ–‡æœ¬
            node_text = Text()
            node_text.append(f"{indicator} ", style=color)
            node_text.append(node_name, style="bold")
            
            if duration > 0:
                node_text.append(f" ({duration:.1f}s)", style="dim")
            
            # æ ‡è®°å½“å‰èŠ‚ç‚¹
            if i == len(self.execution_path) - 1 and status == "running":
                node_text.append(" [å½“å‰]", style="bold yellow")
            
            tree.add(node_text)
        
        return Panel(
            tree,
            title="ğŸ”„ æ‰§è¡Œè·¯å¾„",
            border_style="blue"
        )
    
    def _create_snapshot_panel(self) -> Panel:
        """åˆ›å»ºçŠ¶æ€å¿«ç…§é¢æ¿"""
        from rich.syntax import Syntax
        
        # æ ¼å¼åŒ–çŠ¶æ€å¿«ç…§
        snapshot_json = json.dumps(self.state_snapshot, indent=2, ensure_ascii=False)
        syntax = Syntax(
            snapshot_json,
            "json",
            theme="monokai",
            line_numbers=True,
            word_wrap=True
        )
        
        return Panel(
            syntax,
            title="ğŸ“Š çŠ¶æ€å¿«ç…§",
            border_style="magenta"
        )
    
    def _create_node_details_panel(self) -> Panel:
        """åˆ›å»ºèŠ‚ç‚¹è¯¦æƒ…é¢æ¿"""
        table = Table(show_header=False, box=None)
        table.add_column("å±æ€§", style="bold", width=12)
        table.add_column("å€¼", style="dim")
        
        node = self.current_node_data
        
        table.add_row("èŠ‚ç‚¹", node["name"])
        table.add_row("çŠ¶æ€", self._get_status_text(node["status"]))
        
        if node["start_time"]:
            start_time = node["start_time"].strftime("%H:%M:%S")
            table.add_row("å¼€å§‹æ—¶é—´", start_time)
        
        if node["duration"] > 0:
            table.add_row("è¿è¡Œæ—¶é•¿", f"{node['duration']:.1f}s")
        
        # è¾“å…¥å‚æ•°
        if node["input"]:
            input_count = len(node["input"])
            table.add_row("è¾“å…¥å‚æ•°", f"{input_count} ä¸ªå‚æ•°")
        
        # è¾“å‡ºç»“æœ
        if node["output"] is not None:
            output_type = type(node["output"]).__name__
            table.add_row("è¾“å‡ºç±»å‹", output_type)
        
        # å…ƒæ•°æ®
        if node["metadata"]:
            meta_count = len(node["metadata"])
            table.add_row("å…ƒæ•°æ®", f"{meta_count} é¡¹")
        
        return Panel(
            table,
            title="ğŸ“‹ èŠ‚ç‚¹è¯¦æƒ…",
            border_style="yellow"
        )
    
    def _preview_data(self, data: Any, max_length: int = 50) -> str:
        """é¢„è§ˆæ•°æ®ï¼Œé™åˆ¶é•¿åº¦"""
        data_str = str(data)
        if len(data_str) > max_length:
            return data_str[:max_length] + "..."
        return data_str
    
    def _get_status_text(self, status: str) -> Text:
        """è·å–çŠ¶æ€æ–‡æœ¬"""
        status_colors = {
            "idle": "dim",
            "running": "green",
            "completed": "blue",
            "error": "red",
            "paused": "yellow"
        }
        color = status_colors.get(status, "white")
        return Text(status, style=color)
    
    def update_current_node(self, node_data: Dict[str, Any]) -> None:
        """æ›´æ–°å½“å‰èŠ‚ç‚¹æ•°æ®"""
        self.current_node_data.update(node_data)
    
    def add_execution_step(self, step: Dict[str, Any]) -> None:
        """æ·»åŠ æ‰§è¡Œæ­¥éª¤"""
        self.execution_path.append(step)
        # é™åˆ¶æ‰§è¡Œè·¯å¾„é•¿åº¦ï¼Œé¿å…å†…å­˜æº¢å‡º
        if len(self.execution_path) > 100:
            self.execution_path = self.execution_path[-50:]
    
    def update_state_snapshot(self, snapshot: Dict[str, Any]) -> None:
        """æ›´æ–°çŠ¶æ€å¿«ç…§"""
        self.state_snapshot = snapshot
    
    def clear_execution_path(self) -> None:
        """æ¸…ç©ºæ‰§è¡Œè·¯å¾„"""
        self.execution_path = []
    
    def handle_key(self, key: str) -> bool:
        """å¤„ç†é”®ç›˜è¾“å…¥"""
        if key == "escape":
            return True
        
        # åˆ‡æ¢æ˜¾ç¤ºè®¾ç½®
        if key == "i":
            self.visualization_settings["show_input"] = not self.visualization_settings["show_input"]
            return True
        
        if key == "o":
            self.visualization_settings["show_output"] = not self.visualization_settings["show_output"]
            return True
        
        if key == "m":
            self.visualization_settings["show_metadata"] = not self.visualization_settings["show_metadata"]
            return True
        
        if key == "r":
            self.visualization_settings["auto_refresh"] = not self.visualization_settings["auto_refresh"]
            return True
        
        if key == "c":
            self.clear_execution_path()
            return True
        
        return super().handle_key(key)
    
    def create_help_text(self) -> str:
        """åˆ›å»ºå¸®åŠ©æ–‡æœ¬"""
        return "å¿«æ·é”®: [i]è¾“å…¥ [o]è¾“å‡º [m]å…ƒæ•°æ® [r]è‡ªåŠ¨åˆ·æ–° [c]æ¸…ç©ºè·¯å¾„ [ESC]è¿”å›"
```

## æ•°æ®é›†æˆ

### 1. ä¸ç°æœ‰ç»„ä»¶é›†æˆ

```python
# åœ¨æ¸²æŸ“æ§åˆ¶å™¨ä¸­é›†æˆ
class RenderController:
    def _update_subviews_data(self, state_manager: Any) -> None:
        """æ›´æ–°å­ç•Œé¢æ•°æ®"""
        # ... å…¶ä»–å­ç•Œé¢æ›´æ–°
        
        # æ›´æ–°LangGraphå­ç•Œé¢æ•°æ®
        if self.langgraph_view and state_manager.current_state:
            # è·å–å½“å‰èŠ‚ç‚¹ä¿¡æ¯
            current_node = getattr(state_manager.current_state, 'current_step', 'æœªè¿è¡Œ')
            node_status = "running" if state_manager.current_state.iteration_count < state_manager.current_state.max_iterations else "idle"
            
            # æ›´æ–°å½“å‰èŠ‚ç‚¹æ•°æ®
            node_data = {
                "name": current_node,
                "status": node_status,
                "start_time": getattr(state_manager.current_state, 'start_time', None),
                "duration": getattr(state_manager.current_state, 'current_step_duration', 0.0),
                "input": getattr(state_manager.current_state, 'current_input', {}),
                "output": getattr(state_manager.current_state, 'current_output', None),
                "metadata": getattr(state_manager.current_state, 'current_metadata', {})
            }
            self.langgraph_view.update_current_node(node_data)
            
            # æ›´æ–°æ‰§è¡Œè·¯å¾„
            execution_history = getattr(state_manager.current_state, 'execution_history', [])
            if execution_history:
                latest_step = execution_history[-1]
                self.langgraph_view.add_execution_step(latest_step)
            
            # æ›´æ–°çŠ¶æ€å¿«ç…§
            state_snapshot = {
                "messages": getattr(state_manager.current_state, 'messages', []),
                "current_step": current_node,
                "iteration": getattr(state_manager.current_state, 'iteration_count', 0),
                "max_iterations": getattr(state_manager.current_state, 'max_iterations', 10),
                "tools": getattr(state_manager.current_state, 'available_tools', [])
            }
            self.langgraph_view.update_state_snapshot(state_snapshot)
```

### 2. å¿«æ·é”®æ³¨å†Œ

```python
# åœ¨çŠ¶æ€ç®¡ç†å™¨ä¸­æ³¨å†Œå¿«æ·é”®
# Alt+6: åˆ‡æ¢åˆ°LangGraphå­é¡µé¢
```

## æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®æ›´æ–°ç­–ç•¥
- **å¢é‡æ›´æ–°**ï¼šåªæ›´æ–°å˜åŒ–çš„æ•°æ®
- **èŠ‚æµæ›´æ–°**ï¼šé™åˆ¶æ›´æ–°é¢‘ç‡ï¼Œé¿å…é¢‘ç¹æ¸²æŸ“
- **é€‰æ‹©æ€§æ¸²æŸ“**ï¼šæ ¹æ®è®¾ç½®å†³å®šæ˜¾ç¤ºå“ªäº›æ•°æ®

### 2. å†…å­˜ç®¡ç†
- **æ‰§è¡Œè·¯å¾„é™åˆ¶**ï¼šæœ€å¤šä¿ç•™100ä¸ªæ­¥éª¤
- **çŠ¶æ€å¿«ç…§å‹ç¼©**ï¼šåªä¿ç•™å¿…è¦å­—æ®µ
- **æ•°æ®æ¸…ç†**ï¼šå®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

## ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 1. å®æ—¶æ›´æ–°
- å·¥ä½œæµæ‰§è¡Œæ—¶è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤º
- æ”¯æŒæ‰‹åŠ¨åˆ·æ–°å’Œè‡ªåŠ¨åˆ·æ–°æ¨¡å¼

### 2. äº¤äº’åŠŸèƒ½
- å¿«æ·é”®åˆ‡æ¢æ˜¾ç¤ºé€‰é¡¹
- æ‰§è¡Œè·¯å¾„å¯æ¸…ç©º
- çŠ¶æ€å¿«ç…§å¯æŠ˜å /å±•å¼€

### 3. è§†è§‰åé¦ˆ
- é¢œè‰²ç¼–ç çš„çŠ¶æ€æŒ‡ç¤º
- è¿›åº¦å’Œæ—¶é•¿æ˜¾ç¤º
- é”™è¯¯çŠ¶æ€é«˜äº®

## æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•
- æµ‹è¯•å„ä¸ªé¢æ¿çš„æ¸²æŸ“é€»è¾‘
- æµ‹è¯•æ•°æ®æ›´æ–°å’ŒçŠ¶æ€ç®¡ç†
- æµ‹è¯•å¿«æ·é”®å¤„ç†

### 2. é›†æˆæµ‹è¯•
- æµ‹è¯•ä¸æ¸²æŸ“æ§åˆ¶å™¨çš„é›†æˆ
- æµ‹è¯•ä¸çŠ¶æ€ç®¡ç†å™¨çš„æ•°æ®åŒæ­¥
- æµ‹è¯•å¸ƒå±€é€‚é…æ€§

### 3. æ€§èƒ½æµ‹è¯•
- æµ‹è¯•å¤§æ•°æ®é‡ä¸‹çš„æ¸²æŸ“æ€§èƒ½
- æµ‹è¯•å†…å­˜ä½¿ç”¨æƒ…å†µ
- æµ‹è¯•å“åº”æ—¶é—´

æ­¤è®¾è®¡æä¾›äº†å®Œæ•´çš„LangGraphè°ƒè¯•åŠŸèƒ½ï¼ŒåŒæ—¶ä¿æŒäº†ç•Œé¢çš„æ¸…æ™°å’Œæ˜“ç”¨æ€§ã€‚