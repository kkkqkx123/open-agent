const fs = require('fs');
const path = require('path');

// 需要更新的文件列表
const filesToFix = [
  'src/service/parser/core/normalization/adapters/JavaScriptLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/TypeScriptLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/PythonLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/JavaLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/GoLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/CSharpLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/CppLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/CLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/RustLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/KotlinLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/DefaultLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/VueLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/HtmlLanguageAdapter.ts',
  'src/service/parser/core/normalization/adapters/CssLanguageAdapter.ts'
];

// 旧的签名（包含关系类型）
const oldSignature = /mapQueryTypeToStandardType\(queryType: string\): 'function' \| 'class' \| 'method' \| 'import' \| 'variable' \| 'interface' \| 'type' \| 'export' \| 'control-flow' \| 'expression' \| 'data-flow' \| 'parameter-flow' \| 'return-flow' \| 'exception-flow' \| 'callback-flow' \| 'semantic-relationship' \| 'lifecycle-event' \| 'concurrency-primitive'/g;

// 新的签名（不包含关系类型）
const newSignature = "mapQueryTypeToStandardType(queryType: string): 'function' | 'class' | 'method' | 'import' | 'variable' | 'interface' | 'type' | 'export' | 'control-flow' | 'expression'";

console.log('开始修复 mapQueryTypeToStandardType 方法签名...');

filesToFix.forEach(filePath => {
  try {
    if (fs.existsSync(filePath)) {
      console.log(`正在处理: ${filePath}`);
      let content = fs.readFileSync(filePath, 'utf8');
      
      // 替换方法签名
      content = content.replace(oldSignature, newSignature);
      
      // 写回文件
      fs.writeFileSync(filePath, content, 'utf8');
      console.log(`✓ 已修复: ${filePath}`);
    } else {
      console.log(`⚠ 文件不存在，跳过: ${filePath}`);
    }
  } catch (error) {
    console.error(`✗ 处理文件失败 ${filePath}:`, error.message);
  }
});

console.log('所有文件处理完成！');