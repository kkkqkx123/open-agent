## 问题分析

通过分析代码，我发现了Enter键无法提交消息的问题根源：

### Enter键处理流程

1. **事件引擎** ([`event_engine.py`](src/presentation/tui/event_engine.py:169-170)) 将Enter键转换为 `"enter"` 字符串
2. **输入面板** ([`input_panel.py`](src/presentation/tui/components/input_panel.py:86-87)) 接收到 `"enter"` 并调用 `_handle_enter()` 方法
3. **Enter处理逻辑** ([`input_panel.py`](src/presentation/tui/components/input_panel.py:115-159)) 检查输入文本并决定是否提交

### 问题根源

在 [`_handle_enter()`](src/presentation/tui/components/input_panel.py:115-159) 方法中，存在以下逻辑问题：

1. **第127-132行**：如果文本以 `\` 结尾，会执行换行操作但不提交
2. **第133-135行**：如果文本以空格结尾，会继续执行提交逻辑
3. **第139-149行**：如果是命令，会处理命令并返回结果
4. **第150-159行**：如果是普通消息，会调用 `on_submit` 回调

**关键问题**：在第150-159行的普通消息处理中，虽然调用了 `on_submit(text)` 回调，但方法最后返回 `None`，而不是返回提交的文本。这导致事件引擎认为输入没有被处理，可能影响了后续的处理流程。


## 修复方案设计

基于问题分析，我设计了以下修复方案：

### 方案1：修改 `_handle_enter()` 方法的返回值逻辑

**问题**：普通消息处理时，虽然调用了 `on_submit` 回调，但返回 `None`，可能导致事件引擎认为输入未被正确处理。

**修复**：在普通消息处理完成后，返回一个特殊值或文本本身，表示输入已被成功处理。

### 方案2：检查事件引擎的输入处理逻辑

**问题**：可能事件引擎在接输入组件返回 `None` 时没有正确触发后续处理。

**修复**：检查事件引擎中 `_process_key` 方法对输入组件返回值的处理逻辑。

### 方案3：优化回调机制

**问题**：可能回调函数的调用时机或方式有问题。

**修复**：确保回调函数被正确调用，且回调函数中的处理逻辑正确。

### 推荐方案

我推荐采用**方案1**，因为：
1. 问题最直接出现在 `_handle_enter()` 方法的返回值处理上
2. 修改最小，风险最低
3. 符合代码的整体设计模式

具体修改：
1. 在普通消息处理完成后，返回提交的文本或一个特殊标记
2. 确保命令处理和普通消息处理的返回值逻辑一致