# Deep Thinking 工作流配置文件
# 基于深度推理引擎的工作流实现

name: "deep_thinking_workflow"
description: "单Agent深度推理工作流，适用于复杂问题分析和解决方案生成"
version: "1.0.0"

# 工作流元数据
metadata:
  author: "Open Agent Team"
  created_date: "2025-11-10"
  category: "reasoning"
  tags: ["deep-thinking", "reasoning", "problem-solving"]

# 输入参数定义
input_schema:
  type: "object"
  properties:
    problem:
      type: "string"
      description: "需要分析的问题描述"
      required: true
    max_iterations:
      type: "integer"
      description: "最大迭代次数"
      default: 5
      minimum: 1
      maximum: 10
    temperature:
      type: "number"
      description: "LLM温度参数"
      default: 0.7
      minimum: 0.0
      maximum: 1.0
    validation_threshold:
      type: "number"
      description: "验证阈值"
      default: 0.8
      minimum: 0.0
      maximum: 1.0

# 状态定义
states:
  # 初始状态
  initial:
    type: "start"
    description: "工作流开始状态"
    transitions:
      - target: "problem_analysis"
        condition: "always"
        description: "开始问题分析"

  # 问题分析状态
  problem_analysis:
    type: "llm_node"
    description: "分析问题本质和关键要素"
    config:
      model: "gpt-4"
      temperature: "{{input.temperature}}"
      max_tokens: 1000
      prompt: |
        请深入分析以下问题，识别核心要素和关键挑战：
        
        问题：{{input.problem}}
        
        请从以下角度进行分析：
        1. 问题本质和根本原因
        2. 涉及的关键要素和约束条件
        3. 潜在的解决方案方向
        4. 可能遇到的挑战和风险
        
        要求：分析要深入、全面，为后续的深度推理奠定基础。
    transitions:
      - target: "plan_generation"
        condition: "always"
        description: "进入计划生成阶段"

  # 计划生成状态
  plan_generation:
    type: "llm_node"
    description: "生成解决问题的详细计划"
    config:
      model: "gpt-4"
      temperature: "{{input.temperature}}"
      max_tokens: 1500
      prompt: |
        基于问题分析结果，制定详细的解决方案计划：
        
        问题分析：{{states.problem_analysis.output}}
        
        请生成一个结构化的解决方案计划，包括：
        1. 总体解决策略
        2. 具体的实施步骤（分阶段）
        3. 每个步骤的预期目标和验收标准
        4. 资源需求和依赖关系
        5. 风险评估和应对措施
        
        计划应该逻辑清晰、可执行性强。
    transitions:
      - target: "deep_thinking"
        condition: "always"
        description: "进入深度推理阶段"

  # 深度推理状态（核心节点）
  deep_thinking:
    type: "deep_thinking_node"
    description: "执行深度推理，生成解决方案"
    config:
      model: "gpt-4"
      temperature: "{{input.temperature}}"
      max_iterations: "{{input.max_iterations}}"
      self_improvement: true
      reasoning_prompt: |
        基于以下问题和计划，进行深度推理：
        
        问题：{{input.problem}}
        问题分析：{{states.problem_analysis.output}}
        解决计划：{{states.plan_generation.output}}
        
        请进行深度思考，生成高质量的解决方案：
        1. 深入分析问题的各个方面
        2. 考虑多种可能的解决方案
        3. 评估每个方案的优缺点
        4. 选择最优方案并进行详细阐述
        5. 如果需要，可以进行多轮迭代改进
        
        要求：解决方案要创新、可行、全面。
    transitions:
      - target: "solution_validation"
        condition: "always"
        description: "进入解决方案验证阶段"

  # 解决方案验证状态
  solution_validation:
    type: "analysis_node"
    description: "验证解决方案的质量和可行性"
    config:
      validation_rules:
        - type: "completeness"
          threshold: "{{input.validation_threshold}}"
          description: "解决方案完整性检查"
        - type: "feasibility"
          threshold: 0.7
          description: "方案可行性检查"
        - type: "innovation"
          threshold: 0.6
          description: "创新性检查"
        - type: "coherence"
          threshold: 0.8
          description: "逻辑一致性检查"
      
      validation_prompt: |
        请对以下解决方案进行质量评估：
        
        问题：{{input.problem}}
        生成的解决方案：{{states.deep_thinking.output}}
        
        请从以下维度进行评估：
        1. 完整性：方案是否全面覆盖问题各个方面
        2. 可行性：方案是否实际可行
        3. 创新性：方案是否有创新点
        4. 逻辑性：方案逻辑是否严谨一致
        
        给出每个维度的评分（0-1分）和具体评估意见。
    transitions:
      - target: "final"
        condition: "validation_passed"
        description: "验证通过，进入最终状态"
      - target: "deep_thinking"
        condition: "validation_failed"
        description: "验证失败，重新进行深度推理"
        max_retries: 2

  # 最终状态
  final:
    type: "end"
    description: "工作流完成状态"
    output_mapping:
      problem_analysis: "{{states.problem_analysis.output}}"
      solution_plan: "{{states.plan_generation.output}}"
      final_solution: "{{states.deep_thinking.output}}"
      validation_results: "{{states.solution_validation.output}}"
      execution_summary:
        total_iterations: "{{states.deep_thinking.iteration_count}}"
        validation_score: "{{states.solution_validation.overall_score}}"
        execution_time: "{{execution_time}}"

# 错误处理配置
error_handling:
  max_retries: 3
  retry_delay: 5000
  fallback_state: "final"
  error_messages:
    timeout: "工作流执行超时"
    validation_failed: "解决方案验证失败"
    llm_error: "LLM服务调用失败"

# 监控和日志配置
monitoring:
  enable_metrics: true
  log_level: "info"
  metrics:
    - execution_time
    - iteration_count
    - validation_score
    - token_usage

# 性能优化配置
performance:
  enable_caching: true
  cache_ttl: 3600
  parallel_execution: false
  timeout_ms: 300000