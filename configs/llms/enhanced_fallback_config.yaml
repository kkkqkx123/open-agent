# 增强降级管理器配置示例
# 用于配置 FallbackClientWrapper 使用 EnhancedFallbackManager

enhanced_fallback:
  # 是否启用增强降级管理器
  enabled: true
  
  # 任务组配置
  task_group_config:
    # 任务组名称
    default_group: "fast_group"
    
    # 降级组列表
    fallback_groups:
      - "medium_group"
      - "slow_group"
      - "backup_group"
  
  # 降级策略配置
  strategy_config:
    # 降级策略类型: "sequential", "priority", "parallel", "circuit_breaker"
    type: "circuit_breaker"
    
    # 最大尝试次数
    max_attempts: 5
    
    # 熔断器配置
    circuit_breaker:
      failure_threshold: 5    # 失败阈值
      recovery_time: 60       # 恢复时间（秒）
      failure_rate_threshold: 0.5  # 失败率阈值

  # 任务组层级配置
  task_group_levels:
    # 快速响应组
    fast_group:
      models:
        - "gpt-4-turbo"
        - "claude-3-opus"
        - "gemini-1.5-pro"
      timeout: 30
      max_retries: 2
    
    # 中等响应组
    medium_group:
      models:
        - "gpt-4"
        - "claude-3-sonnet"
        - "gemini-1.0-pro"
      timeout: 60
      max_retries: 3
    
    # 慢速响应组
    slow_group:
      models:
        - "gpt-3.5-turbo"
        - "claude-3-haiku"
      timeout: 90
      max_retries: 5
    
    # 备份组
    backup_group:
      models:
        - "llama-3-70b"
        - "mixtral-8x7b"
      timeout: 120
      max_retries: 3

  # 轮询池配置
  polling_pool_config:
    enabled: true
    pools:
      fast_pool:
        models:
          - "gpt-4-turbo"
          - "claude-3-opus"
        strategy: "round_robin"
        timeout: 30
      medium_pool:
        models:
          - "gpt-4"
          - "claude-3-sonnet"
        strategy: "round_robin"
        timeout: 60

  # 监控和统计配置
  monitoring:
    enabled: true
    log_level: "INFO"
    metrics_collection:
      enabled: true
      interval: 60  # 每60秒收集一次指标

  # 降级触发条件
  fallback_conditions:
    # 基于错误类型的降级
    error_based_fallback:
      enabled: true
      error_types:
        - "RateLimitError"
        - "TimeoutError"
        - "ServiceUnavailableError"
        - "QuotaExceededError"
    
    # 基于响应时间的降级
    timeout_based_fallback:
      enabled: true
      threshold: 45  # 超过45秒则触发降级
    
    # 基于成功率的降级
    success_rate_based_fallback:
      enabled: true
      threshold: 0.7  # 成功率低于70%时触发降级
      window_size: 10  # 基于最近10次请求计算成功率