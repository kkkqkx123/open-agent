# 工作流服务配置
# 展示如何使用依赖注入架构配置工作流服务

# 服务注册配置
services:
  # 工作流注册表
  - interface: "src.interfaces.workflow.registry.IWorkflowRegistry"
    implementation: "src.core.workflow.registry.WorkflowRegistry"
    lifetime: "singleton"
    
  # 工作流构建器
  - interface: "src.interfaces.workflow.core.IWorkflowBuilder"
    implementation: "src.core.workflow.core.builder.WorkflowBuilder"
    lifetime: "transient"
    
  # 工作流执行器
  - interface: "src.interfaces.workflow.execution.IWorkflowExecutor"
    implementation: "src.core.workflow.execution.executor.WorkflowExecutor"
    lifetime: "singleton"
    
  # 工作流验证器
  - interface: "src.interfaces.workflow.core.IWorkflowValidator"
    implementation: "src.core.workflow.validation.WorkflowValidator"
    lifetime: "singleton"
    
  # 生命周期管理器
  - interface: "src.core.workflow.management.lifecycle.WorkflowLifecycleManager"
    implementation: "src.core.workflow.management.lifecycle.WorkflowLifecycleManager"
    lifetime: "scoped"
    
  # 图服务
  - interface: "src.core.workflow.graph.service.GraphService"
    factory: "src.core.workflow.graph.service.create_graph_service"
    lifetime: "singleton"
    
  # 工作流协调器
  - interface: "src.interfaces.workflow.coordinator.IWorkflowCoordinator"
    factory: "src.core.workflow.coordinator.create_workflow_coordinator"
    lifetime: "transient"

# 环境特定配置
environments:
  development:
    # 开发环境配置
    services:
      - interface: "src.interfaces.workflow.execution.IWorkflowExecutor"
        implementation: "src.core.workflow.execution.executor.WorkflowExecutor"
        lifetime: "singleton"
        config:
          enable_debug: true
          max_execution_time: 300
          
  production:
    # 生产环境配置
    services:
      - interface: "src.interfaces.workflow.execution.IWorkflowExecutor"
        implementation: "src.core.workflow.execution.executor.WorkflowExecutor"
        lifetime: "singleton"
        config:
          enable_debug: false
          max_execution_time: 3600
          enable_monitoring: true

# 业务规则配置
business_rules:
  # 环境规则
  environments:
    development:
      max_iterations: 10
      timeout: 300
      restricted_mode: false
      
    production:
      max_iterations: 100
      timeout: 3600
      restricted_mode: true
      
    testing:
      max_iterations: 5
      timeout: 60
      restricted_mode: false
  
  # 用户角色规则
  user_roles:
    guest:
      restricted_types: ["admin_workflow", "system_workflow"]
      max_nodes: 10
      
    user:
      restricted_types: []
      max_nodes: 50
      
    admin:
      restricted_types: []
      max_nodes: 1000
      
  # 资源限制
  resource_limits:
    default:
      max_nodes: 50
      max_edges: 100
      max_execution_time: 300
      
    premium:
      max_nodes: 500
      max_edges: 1000
      max_execution_time: 1800

# 工作流模板配置
workflow_templates:
  # 简单聊天工作流
  simple_chat:
    name: "simple_chat"
    description: "简单的聊天工作流"
    nodes:
      - id: "start"
        type: "start_node"
        name: "开始"
      - id: "llm"
        type: "llm_node"
        name: "LLM处理"
        config:
          system_prompt: "你是一个智能助手"
          max_tokens: 1000
      - id: "end"
        type: "end_node"
        name: "结束"
    edges:
      - id: "edge_1"
        from: "start"
        to: "llm"
        type: "simple"
      - id: "edge_2"
        from: "llm"
        to: "end"
        type: "simple"
    entry_point: "start"
    
  # 工具调用工作流
  tool_workflow:
    name: "tool_workflow"
    description: "包含工具调用的工作流"
    nodes:
      - id: "start"
        type: "start_node"
        name: "开始"
      - id: "llm"
        type: "llm_node"
        name: "LLM处理"
        config:
          system_prompt: "你是一个可以使用工具的助手"
          enable_tools: true
      - id: "tool_check"
        type: "condition_node"
        name: "工具检查"
        config:
          condition: "has_tool_calls"
      - id: "tool_execute"
        type: "tool_node"
        name: "工具执行"
      - id: "end"
        type: "end_node"
        name: "结束"
    edges:
      - id: "edge_1"
        from: "start"
        to: "llm"
        type: "simple"
      - id: "edge_2"
        from: "llm"
        to: "tool_check"
        type: "simple"
      - id: "edge_3"
        from: "tool_check"
        to: "tool_execute"
        type: "conditional"
        condition: "has_tool_calls"
      - id: "edge_4"
        from: "tool_check"
        to: "end"
        type: "conditional"
        condition: "no_tool_calls"
      - id: "edge_5"
        from: "tool_execute"
        to: "llm"
        type: "simple"
      - id: "edge_6"
        from: "llm"
        to: "end"
        type: "conditional"
        condition: "no_tool_calls"
    entry_point: "start"

# 监控配置
monitoring:
  # 性能监控
  performance:
    enable: true
    metrics:
      - "execution_time"
      - "node_count"
      - "edge_count"
      - "memory_usage"
    
  # 审计日志
  audit:
    enable: true
    log_level: "INFO"
    events:
      - "workflow_created"
      - "workflow_executed"
      - "workflow_failed"
      - "user_action"
    
  # 错误追踪
  error_tracking:
    enable: true
    max_error_history: 1000
    notification_channels:
      - "email"
      - "slack"