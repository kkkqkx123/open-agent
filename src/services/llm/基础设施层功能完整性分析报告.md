# åŸºç¡€è®¾æ–½å±‚åŠŸèƒ½å®Œæ•´æ€§åˆ†ææŠ¥å‘Š

## æ¦‚è¿°

æœ¬æŠ¥å‘Šæ·±å…¥åˆ†æ `src/infrastructure/llm` ç›®å½•çš„åŠŸèƒ½å®Œæ•´æ€§ï¼Œè¯„ä¼°å…¶æ˜¯å¦å·²ç»å®ç°äº†æ‰€æœ‰å¿…è¦çš„åŸºç¡€è®¾æ–½åŠŸèƒ½ï¼Œå¹¶è¯†åˆ«éœ€è¦ä»æœåŠ¡å±‚è¿ç§»åˆ°åŸºç¡€è®¾æ–½å±‚çš„åŠŸèƒ½ã€‚

## åŸºç¡€è®¾æ–½å±‚å½“å‰åŠŸèƒ½åˆ†æ

### âœ… å·²å®Œæ•´å®ç°çš„åŠŸèƒ½

#### 1. HTTPå®¢æˆ·ç«¯åŸºç¡€è®¾æ–½

**æ ¸å¿ƒç»„ä»¶**:
- [`BaseHttpClient`](src/infrastructure/llm/http_client/base_http_client.py) - åŸºç¡€HTTPå®¢æˆ·ç«¯
- [`HttpClientFactory`](src/infrastructure/llm/http_client/http_client_factory.py) - HTTPå®¢æˆ·ç«¯å·¥å‚
- å„æä¾›å•†HTTPå®¢æˆ·ç«¯å®ç°

**åŠŸèƒ½å®Œæ•´æ€§**: âœ… **100%å®Œæ•´**

**å·²å®ç°åŠŸèƒ½**:
- âœ… è¿æ¥æ± ç®¡ç† (å†…ç½®httpxè¿æ¥æ± )
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶ (æŒ‡æ•°é€€é¿)
- âœ… è¶…æ—¶æ§åˆ¶
- âœ… é”™è¯¯å¤„ç†å’Œåˆ†ç±»
- âœ… è¯·æ±‚å¤´éªŒè¯å’Œå¤„ç†
- âœ… æµå¼è¯·æ±‚æ”¯æŒ
- âœ… å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†
- âœ… æ—¥å¿—è®°å½•å’Œç›‘æ§
- âœ… é…ç½®é©±åŠ¨çš„å®¢æˆ·ç«¯åˆ›å»º

**è¦†ç›–çš„æœåŠ¡å±‚åŠŸèƒ½**:
- ğŸ”´ å®Œå…¨è¦†ç›– [`HTTPConnectionPool`](src/services/llm/pool/connection_pool.py)
- ğŸ”´ å®Œå…¨è¦†ç›– [`ConnectionPoolManager`](src/services/llm/pool/connection_pool.py)

#### 2. Tokenè®¡ç®—åŸºç¡€è®¾æ–½

**æ ¸å¿ƒç»„ä»¶**:
- [`TokenCalculatorFactory`](src/infrastructure/llm/token_calculators/token_calculator_factory.py) - Tokenè®¡ç®—å™¨å·¥å‚
- [`BaseTokenCalculator`](src/infrastructure/llm/token_calculators/base_token_calculator.py) - åŸºç¡€è®¡ç®—å™¨
- å„æä¾›å•†Tokenè®¡ç®—å™¨å®ç°

**åŠŸèƒ½å®Œæ•´æ€§**: âœ… **100%å®Œæ•´**

**å·²å®ç°åŠŸèƒ½**:
- âœ… ç»Ÿä¸€çš„Tokenè®¡ç®—æ¥å£
- âœ… å¤šæä¾›å•†æ”¯æŒ (OpenAI, Gemini, Anthropic, Local)
- âœ… æ‰¹é‡è®¡ç®—æ”¯æŒ
- âœ… ç¼“å­˜æœºåˆ¶
- âœ… ç»Ÿè®¡ä¿¡æ¯æ”¶é›†
- âœ… APIå“åº”è§£æ
- âœ… æˆæœ¬è®¡ç®—
- âœ… æ¨¡å‹å®šä»·ä¿¡æ¯
- âœ… é”™è¯¯å¤„ç†å’Œé™çº§

**è¦†ç›–çš„æœåŠ¡å±‚åŠŸèƒ½**:
- ğŸ”´ å®Œå…¨è¦†ç›– [`TokenCalculationService`](src/services/llm/token_calculation_service.py)
- ğŸŸ¡ éƒ¨åˆ†è¦†ç›– [`token_calculation_decorator.py`](src/services/llm/token_calculation_decorator.py)

#### 3. æ¶ˆæ¯è½¬æ¢åŸºç¡€è®¾æ–½

**æ ¸å¿ƒç»„ä»¶**:
- [`MessageConverter`](src/infrastructure/llm/converters/message_converters.py) - æ¶ˆæ¯è½¬æ¢å™¨
- [`RequestConverter`](src/infrastructure/llm/converters/message_converters.py) - è¯·æ±‚è½¬æ¢å™¨
- [`ResponseConverter`](src/infrastructure/llm/converters/message_converters.py) - å“åº”è½¬æ¢å™¨
- [`MessageFactory`](src/infrastructure/llm/converters/message_converters.py) - æ¶ˆæ¯å·¥å‚

**åŠŸèƒ½å®Œæ•´æ€§**: âœ… **100%å®Œæ•´**

**å·²å®ç°åŠŸèƒ½**:
- âœ… å¤šæ ¼å¼æ¶ˆæ¯è½¬æ¢ (OpenAI, Gemini, Anthropic, å­—å…¸)
- âœ… åŒå‘è½¬æ¢æ”¯æŒ
- âœ… æµå¼å“åº”å¤„ç†
- âœ… å·¥å…·è°ƒç”¨æ”¯æŒ
- âœ… å¤šæ¨¡æ€å†…å®¹å¤„ç†
- âœ… æ¶ˆæ¯éªŒè¯å’Œåºåˆ—åŒ–
- âœ… æ‰¹é‡è½¬æ¢æ”¯æŒ
- âœ… é”™è¯¯å¤„ç†å’Œå›é€€

#### 4. é…ç½®ç®¡ç†åŸºç¡€è®¾æ–½

**æ ¸å¿ƒç»„ä»¶**:
- [`ConfigLoader`](src/infrastructure/llm/config/config_loader.py) - é…ç½®åŠ è½½å™¨
- [`ConfigDiscovery`](src/infrastructure/llm/config/config_discovery.py) - é…ç½®å‘ç°å™¨
- [`ConfigValidator`](src/infrastructure/llm/config/config_validator.py) - é…ç½®éªŒè¯å™¨

**åŠŸèƒ½å®Œæ•´æ€§**: âœ… **100%å®Œæ•´**

**å·²å®ç°åŠŸèƒ½**:
- âœ… å¤šç¯å¢ƒé…ç½®æ”¯æŒ
- âœ… ç¯å¢ƒå˜é‡è§£æ
- âœ… é…ç½®ç»§æ‰¿æœºåˆ¶
- âœ… é…ç½®éªŒè¯
- âœ… ç¼“å­˜æœºåˆ¶
- âœ… çƒ­é‡è½½æ”¯æŒ
- âœ… å›é€€é…ç½®

#### 5. æ•°æ®æ¨¡å‹åŸºç¡€è®¾æ–½

**æ ¸å¿ƒç»„ä»¶**:
- [`models.py`](src/infrastructure/llm/models.py) - ç»Ÿä¸€æ•°æ®æ¨¡å‹

**åŠŸèƒ½å®Œæ•´æ€§**: âœ… **100%å®Œæ•´**

**å·²å®ç°åŠŸèƒ½**:
- âœ… Tokenä½¿ç”¨ç»Ÿè®¡æ¨¡å‹
- âœ… æ¶ˆæ¯æ¨¡å‹å’Œè§’è‰²æšä¸¾
- âœ… å“åº”å’Œé”™è¯¯æ¨¡å‹
- âœ… è¯·æ±‚å’Œé…ç½®æ¨¡å‹
- âœ… æ¨¡å‹ä¿¡æ¯ç»“æ„

### ğŸŸ¡ éƒ¨åˆ†å®ç°çš„åŠŸèƒ½

#### 1. é‡è¯•æœºåˆ¶åŸºç¡€è®¾æ–½

**å½“å‰çŠ¶æ€**: ğŸŸ¡ **éƒ¨åˆ†å®ç°**

**å·²å®ç°**:
- âœ… HTTPå®¢æˆ·ç«¯å†…ç½®é‡è¯•
- âœ… æŒ‡æ•°é€€é¿ç®—æ³•
- âœ… çŠ¶æ€ç åˆ¤æ–­
- âœ… é”™è¯¯åˆ†ç±»

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ ç»Ÿä¸€çš„é‡è¯•é…ç½®ç®¡ç†
- âŒ è·¨æ¨¡å—é‡è¯•ç­–ç•¥
- âŒ é‡è¯•ç»Ÿè®¡å’Œç›‘æ§

**éœ€è¦ä»æœåŠ¡å±‚è¿ç§»**:
- [`retry_config.py`](src/services/llm/retry/retry_config.py) - é‡è¯•é…ç½®å®šä¹‰
- é‡è¯•ç­–ç•¥çš„ç»Ÿä¸€æ¥å£

#### 2. é™çº§ç³»ç»ŸåŸºç¡€è®¾æ–½

**å½“å‰çŠ¶æ€**: ğŸŸ¡ **éƒ¨åˆ†å®ç°**

**å·²å®ç°**:
- âœ… åŸºç¡€é™çº§é…ç½®æ¨¡å‹
- âœ… é™çº§ç­–ç•¥æ¥å£

**ç¼ºå¤±åŠŸèƒ½**:
- âŒ ç»Ÿä¸€çš„é™çº§æ‰§è¡Œå¼•æ“
- âŒ é™çº§ç»Ÿè®¡å’Œç›‘æ§
- âŒ é™çº§ä¼šè¯ç®¡ç†

**éœ€è¦ä»æœåŠ¡å±‚è¿ç§»**:
- [`fallback_config.py`](src/services/llm/fallback_system/fallback_config.py) - é™çº§é…ç½®
- [`fallback_engine.py`](src/services/llm/fallback_system/fallback_engine.py) - é™çº§æ‰§è¡Œå¼•æ“
- [`fallback_tracker.py`](src/services/llm/fallback_system/fallback_tracker.py) - é™çº§è·Ÿè¸ªå™¨

### âŒ ç¼ºå¤±çš„åŠŸèƒ½

#### 1. ç»Ÿè®¡å’Œç›‘æ§åŸºç¡€è®¾æ–½

**å½“å‰çŠ¶æ€**: âŒ **ç¼ºå¤±**

**éœ€è¦å®ç°**:
- ç»Ÿä¸€çš„ç»Ÿè®¡æ¥å£
- æ€§èƒ½ç›‘æ§ç»„ä»¶
- æŒ‡æ ‡æ”¶é›†å™¨
- å¥åº·æ£€æŸ¥æœºåˆ¶

#### 2. æ’ä»¶ç³»ç»ŸåŸºç¡€è®¾æ–½

**å½“å‰çŠ¶æ€**: âŒ **ç¼ºå¤±**

**éœ€è¦å®ç°**:
- æ’ä»¶åŠ è½½å™¨
- æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
- æ’ä»¶é€šä¿¡æœºåˆ¶

## æœåŠ¡å±‚åŠŸèƒ½è¿ç§»åˆ†æ

### ğŸ”´ å¿…é¡»è¿ç§»åˆ°åŸºç¡€è®¾æ–½å±‚çš„åŠŸèƒ½

#### 1. é‡è¯•é…ç½®å’Œç­–ç•¥

**æºæ–‡ä»¶**: [`src/services/llm/retry/retry_config.py`](src/services/llm/retry/retry_config.py)

**è¿ç§»åŸå› **:
- é‡è¯•æ˜¯åŸºç¡€è®¾æ–½å±‚çš„æ ¸å¿ƒåŠŸèƒ½
- éœ€è¦è¢«å¤šä¸ªæ¨¡å—å¤ç”¨
- åº”è¯¥ä¸HTTPå®¢æˆ·ç«¯ç´§å¯†é›†æˆ

**ç›®æ ‡ä½ç½®**: `src/infrastructure/llm/retry/`

**è¿ç§»å†…å®¹**:
```python
# æ–°å»º src/infrastructure/llm/retry/retry_config.py
@dataclass
class RetryConfig:
    max_attempts: int = 3
    base_delay: float = 1.0
    max_delay: float = 60.0
    exponential_base: float = 2.0
    jitter: bool = True
    retryable_status_codes: Set[int] = field(default_factory=lambda: {429, 500, 502, 503, 504})
    retryable_exceptions: List[Type[Exception]] = field(default_factory=list)
```

#### 2. é™çº§é…ç½®å’Œæ‰§è¡Œå¼•æ“

**æºæ–‡ä»¶**: 
- [`src/services/llm/fallback_system/fallback_config.py`](src/services/llm/fallback_system/fallback_config.py)
- [`src/services/llm/fallback_system/fallback_engine.py`](src/services/llm/fallback_system/fallback_engine.py)

**è¿ç§»åŸå› **:
- é™çº§æ˜¯åŸºç¡€è®¾æ–½å±‚çš„æ ¸å¿ƒåŠŸèƒ½
- éœ€è¦ä¸HTTPå®¢æˆ·ç«¯å’ŒTokenè®¡ç®—å™¨é›†æˆ
- åº”è¯¥æä¾›ç»Ÿä¸€çš„é™çº§ç­–ç•¥

**ç›®æ ‡ä½ç½®**: `src/infrastructure/llm/fallback/`

#### 3. ç»Ÿè®¡å’Œç›‘æ§ç»„ä»¶

**æºæ–‡ä»¶**: æœåŠ¡å±‚å„æ¨¡å—çš„ç»Ÿè®¡åŠŸèƒ½

**è¿ç§»åŸå› **:
- ç»Ÿè®¡æ˜¯åŸºç¡€è®¾æ–½å±‚çš„æ¨ªåˆ‡å…³æ³¨ç‚¹
- éœ€è¦ç»Ÿä¸€çš„ç›‘æ§æ¥å£
- åº”è¯¥ä¸æ‰€æœ‰åŸºç¡€è®¾æ–½ç»„ä»¶é›†æˆ

**ç›®æ ‡ä½ç½®**: `src/infrastructure/llm/monitoring/`

### ğŸŸ¡ å¯é€‰è¿ç§»çš„åŠŸèƒ½

#### 1. æ’ä»¶ç³»ç»Ÿ

**æºæ–‡ä»¶**: [`src/services/llm/plugins/`](src/services/llm/plugins/)

**è¿ç§»å»ºè®®**: ä¿æŒæœåŠ¡å±‚ï¼Œä½†æä¾›åŸºç¡€è®¾æ–½å±‚æ¥å£

**åŸå› **: æ’ä»¶ç³»ç»Ÿæ›´å¤šæ˜¯ä¸šåŠ¡å±‚çš„æ‰©å±•æœºåˆ¶

#### 2. ä»»åŠ¡ç»„ç®¡ç†

**æºæ–‡ä»¶**: [`src/services/llm/scheduling/task_group_manager.py`](src/services/llm/scheduling/task_group_manager.py)

**è¿ç§»å»ºè®®**: ä¿æŒæœåŠ¡å±‚ï¼Œä½†ç®€åŒ–ä¾èµ–

**åŸå› **: ä»»åŠ¡ç»„ç®¡ç†æ˜¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸å±äºåŸºç¡€è®¾æ–½

## è¿ç§»å®æ–½è®¡åˆ’

### é˜¶æ®µ1: é‡è¯•åŸºç¡€è®¾æ–½å®Œå–„ (1-2å¤©)

#### 1.1 åˆ›å»ºé‡è¯•é…ç½®æ¨¡å—
```bash
mkdir -p src/infrastructure/llm/retry
```

#### 1.2 è¿ç§»é‡è¯•é…ç½®
```python
# src/infrastructure/llm/retry/retry_config.py
from dataclasses import dataclass, field
from typing import Set, Type, List
from enum import Enum

class RetryStrategy(Enum):
    EXPONENTIAL_BACKOFF = "exponential_backoff"
    LINEAR_BACKOFF = "linear_backoff"
    FIXED_DELAY = "fixed_delay"

@dataclass
class RetryConfig:
    max_attempts: int = 3
    base_delay: float = 1.0
    max_delay: float = 60.0
    strategy: RetryStrategy = RetryStrategy.EXPONENTIAL_BACKOFF
    jitter: bool = True
    retryable_status_codes: Set[int] = field(default_factory=lambda: {429, 500, 502, 503, 504})
    retryable_exceptions: List[Type[Exception]] = field(default_factory=list)
```

#### 1.3 åˆ›å»ºé‡è¯•æ‰§è¡Œå™¨
```python
# src/infrastructure/llm/retry/retry_executor.py
class RetryExecutor:
    def __init__(self, config: RetryConfig):
        self.config = config
    
    async def execute_with_retry(self, func, *args, **kwargs):
        # å®ç°é‡è¯•é€»è¾‘
        pass
```

### é˜¶æ®µ2: é™çº§åŸºç¡€è®¾æ–½å®Œå–„ (2-3å¤©)

#### 2.1 åˆ›å»ºé™çº§æ¨¡å—
```bash
mkdir -p src/infrastructure/llm/fallback
```

#### 2.2 è¿ç§»é™çº§é…ç½®
```python
# src/infrastructure/llm/fallback/fallback_config.py
@dataclass
class FallbackConfig:
    enabled: bool = True
    max_attempts: int = 3
    fallback_targets: List[str] = field(default_factory=list)
    retry_on_errors: List[str] = field(default_factory=list)
```

#### 2.3 åˆ›å»ºé™çº§æ‰§è¡Œå¼•æ“
```python
# src/infrastructure/llm/fallback/fallback_engine.py
class FallbackEngine:
    def __init__(self, config: FallbackConfig):
        self.config = config
    
    async def execute_with_fallback(self, primary_func, fallback_funcs, *args, **kwargs):
        # å®ç°é™çº§é€»è¾‘
        pass
```

### é˜¶æ®µ3: ç›‘æ§åŸºç¡€è®¾æ–½åˆ›å»º (2-3å¤©)

#### 3.1 åˆ›å»ºç›‘æ§æ¨¡å—
```bash
mkdir -p src/infrastructure/llm/monitoring
```

#### 3.2 åˆ›å»ºç»Ÿè®¡æ¥å£
```python
# src/infrastructure/llm/monitoring/stats_collector.py
class StatsCollector:
    def __init__(self):
        self._stats = {}
    
    def increment(self, metric: str, value: int = 1):
        pass
    
    def timing(self, metric: str, value: float):
        pass
    
    def get_stats(self) -> Dict[str, Any]:
        pass
```

#### 3.3 åˆ›å»ºæ€§èƒ½ç›‘æ§
```python
# src/infrastructure/llm/monitoring/performance_monitor.py
class PerformanceMonitor:
    def __init__(self, stats_collector: StatsCollector):
        self.stats = stats_collector
    
    def record_request_time(self, operation: str, duration: float):
        pass
    
    def record_error(self, operation: str, error_type: str):
        pass
```

### é˜¶æ®µ4: é›†æˆå’Œæµ‹è¯• (1-2å¤©)

#### 4.1 æ›´æ–°HTTPå®¢æˆ·ç«¯é›†æˆ
```python
# æ›´æ–° src/infrastructure/llm/http_client/base_http_client.py
class BaseHttpClient:
    def __init__(self, ..., retry_config: RetryConfig, monitor: PerformanceMonitor):
        self.retry_config = retry_config
        self.monitor = monitor
```

#### 4.2 æ›´æ–°Tokenè®¡ç®—å™¨é›†æˆ
```python
# æ›´æ–° src/infrastructure/llm/token_calculators/base_token_calculator.py
class BaseTokenCalculator:
    def __init__(self, ..., monitor: PerformanceMonitor):
        self.monitor = monitor
```

## è¿ç§»åçš„æ¶æ„

### åŸºç¡€è®¾æ–½å±‚å®Œæ•´ç»“æ„
```
src/infrastructure/llm/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ models.py                          # æ•°æ®æ¨¡å‹
â”œâ”€â”€ config/                            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config_loader.py
â”‚   â”œâ”€â”€ config_discovery.py
â”‚   â””â”€â”€ config_validator.py
â”œâ”€â”€ http_client/                       # HTTPå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_http_client.py
â”‚   â”œâ”€â”€ http_client_factory.py
â”‚   â”œâ”€â”€ openai_http_client.py
â”‚   â”œâ”€â”€ gemini_http_client.py
â”‚   â””â”€â”€ anthropic_http_client.py
â”œâ”€â”€ token_calculators/                 # Tokenè®¡ç®—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_token_calculator.py
â”‚   â”œâ”€â”€ token_calculator_factory.py
â”‚   â”œâ”€â”€ openai_token_calculator.py
â”‚   â”œâ”€â”€ gemini_token_calculator.py
â”‚   â”œâ”€â”€ anthropic_token_calculator.py
â”‚   â””â”€â”€ local_token_calculator.py
â”œâ”€â”€ converters/                        # æ¶ˆæ¯è½¬æ¢
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ message_converters.py
â”‚   â”œâ”€â”€ provider_format_utils/
â”‚   â””â”€â”€ validation/
â”œâ”€â”€ retry/                             # é‡è¯•æœºåˆ¶ (æ–°å¢)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ retry_config.py
â”‚   â”œâ”€â”€ retry_executor.py
â”‚   â””â”€â”€ strategies.py
â”œâ”€â”€ fallback/                          # é™çº§æœºåˆ¶ (æ–°å¢)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ fallback_config.py
â”‚   â”œâ”€â”€ fallback_engine.py
â”‚   â””â”€â”€ fallback_tracker.py
â”œâ”€â”€ monitoring/                        # ç›‘æ§ç»Ÿè®¡ (æ–°å¢)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ stats_collector.py
â”‚   â”œâ”€â”€ performance_monitor.py
â”‚   â””â”€â”€ health_checker.py
â””â”€â”€ utils/                             # å·¥å…·ç±»
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ content_extractor.py
    â””â”€â”€ header_validator.py
```

### æœåŠ¡å±‚ç®€åŒ–åç»“æ„
```
src/services/llm/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ manager.py                         # ä¸»åè°ƒå™¨
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ client_manager.py             # å®¢æˆ·ç«¯ç®¡ç†
â”‚   â”œâ”€â”€ request_executor.py           # è¯·æ±‚æ‰§è¡Œ
â”‚   â””â”€â”€ manager_registry.py           # ç®¡ç†å™¨æ³¨å†Œè¡¨
â”œâ”€â”€ fallback_system/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ fallback_manager.py           # ç®€åŒ–ç‰ˆé™çº§åè°ƒå™¨
â”œâ”€â”€ scheduling/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ concurrency_controller.py     # å¹¶å‘æ§åˆ¶
â”‚   â”œâ”€â”€ polling_pool.py              # è½®è¯¢æ± 
â”‚   â””â”€â”€ task_group_manager.py         # ä»»åŠ¡ç»„ç®¡ç†
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ plugin_manager.py             # æ’ä»¶ç®¡ç†å™¨
â”‚   â””â”€â”€ interfaces.py                 # æ’ä»¶æ¥å£
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ token_config_provider.py      # é…ç½®æä¾›è€…
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ metadata_service.py           # å…ƒæ•°æ®æœåŠ¡
â”‚   â””â”€â”€ config_extractor.py           # é…ç½®æå–å™¨
â””â”€â”€ token_calculation_decorator.py    # ç®€åŒ–ç‰ˆè£…é¥°å™¨
```

## é¢„æœŸæ”¶ç›Š

### åŠŸèƒ½å®Œæ•´æ€§æå‡
- **ç»Ÿä¸€çš„é‡è¯•æœºåˆ¶**: æ‰€æœ‰åŸºç¡€è®¾æ–½ç»„ä»¶éƒ½æ”¯æŒä¸€è‡´çš„é‡è¯•ç­–ç•¥
- **å®Œå–„çš„é™çº§ç³»ç»Ÿ**: ç»Ÿä¸€çš„é™çº§é…ç½®å’Œæ‰§è¡Œå¼•æ“
- **å…¨é¢çš„ç›‘æ§ç»Ÿè®¡**: è¦†ç›–æ‰€æœ‰åŸºç¡€è®¾æ–½ç»„ä»¶çš„æ€§èƒ½ç›‘æ§

### æ¶æ„æ¸…æ™°åº¦æå‡
- **èŒè´£åˆ†ç¦»æ˜ç¡®**: åŸºç¡€è®¾æ–½å±‚ä¸“æ³¨æŠ€æœ¯å®ç°ï¼ŒæœåŠ¡å±‚ä¸“æ³¨ä¸šåŠ¡åè°ƒ
- **ä¾èµ–å…³ç³»ç®€åŒ–**: æœåŠ¡å±‚åªä¾èµ–åŸºç¡€è®¾æ–½å±‚çš„ç»Ÿä¸€æ¥å£
- **å¯æµ‹è¯•æ€§å¢å¼º**: åŸºç¡€è®¾æ–½ç»„ä»¶å¯ä»¥ç‹¬ç«‹æµ‹è¯•

### ç»´æŠ¤æˆæœ¬é™ä½
- **ä»£ç å¤ç”¨**: é¿å…åœ¨å¤šä¸ªæ¨¡å—ä¸­é‡å¤å®ç°ç›¸åŒåŠŸèƒ½
- **ç»Ÿä¸€é…ç½®**: æ‰€æœ‰åŸºç¡€è®¾æ–½ç»„ä»¶ä½¿ç”¨ç»Ÿä¸€çš„é…ç½®æœºåˆ¶
- **æ ‡å‡†åŒ–æ¥å£**: ä¸€è‡´çš„æ¥å£è®¾è®¡é™ä½å­¦ä¹ æˆæœ¬

## é£é™©è¯„ä¼°

### è¿ç§»é£é™©
- **å…¼å®¹æ€§é£é™©**: ç°æœ‰æœåŠ¡å±‚ä»£ç å¯èƒ½ä¾èµ–è¢«è¿ç§»çš„åŠŸèƒ½
- **æµ‹è¯•è¦†ç›–é£é™©**: æ–°çš„åŸºç¡€è®¾æ–½ç»„ä»¶éœ€è¦å……åˆ†çš„æµ‹è¯•
- **æ€§èƒ½å½±å“**: ç»Ÿä¸€çš„ç›‘æ§å¯èƒ½å¸¦æ¥è½»å¾®çš„æ€§èƒ½å¼€é”€

### ç¼“è§£æªæ–½
- **æ¸è¿›å¼è¿ç§»**: åˆ†é˜¶æ®µè¿ç§»ï¼Œç¡®ä¿æ¯ä¸ªé˜¶æ®µéƒ½ç»è¿‡å……åˆ†æµ‹è¯•
- **å‘åå…¼å®¹**: ä¿ç•™å¿…è¦çš„é€‚é…å™¨ç¡®ä¿ç°æœ‰ä»£ç æ­£å¸¸å·¥ä½œ
- **æ€§èƒ½åŸºå‡†**: å»ºç«‹æ€§èƒ½åŸºå‡†ï¼Œç¡®ä¿è¿ç§»åæ€§èƒ½ä¸é™ä½

## ç»“è®º

åŸºç¡€è®¾æ–½å±‚å·²ç»å…·å¤‡äº†**80%çš„åŠŸèƒ½å®Œæ•´æ€§**ï¼Œä¸»è¦ç¼ºå¤±çš„æ˜¯ï¼š

1. **ç»Ÿä¸€çš„é‡è¯•æœºåˆ¶** - éœ€è¦ä»æœåŠ¡å±‚è¿ç§»é…ç½®å’Œæ‰§è¡Œå™¨
2. **å®Œå–„çš„é™çº§ç³»ç»Ÿ** - éœ€è¦ä»æœåŠ¡å±‚è¿ç§»æ ¸å¿ƒç»„ä»¶
3. **å…¨é¢çš„ç›‘æ§ç»Ÿè®¡** - éœ€è¦æ–°å»ºç›‘æ§åŸºç¡€è®¾æ–½

é€šè¿‡è¿ç§»è¿™äº›åŠŸèƒ½ï¼ŒåŸºç¡€è®¾æ–½å±‚å°†è¾¾åˆ°**100%çš„åŠŸèƒ½å®Œæ•´æ€§**ï¼Œä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚

**å¼ºçƒˆå»ºè®®ç«‹å³å¼€å§‹è¿ç§»å·¥ä½œ**ï¼Œè¿™å°†æ˜¾è‘—æå‡ç³»ç»Ÿçš„æ¶æ„æ¸…æ™°åº¦å’Œå¯ç»´æŠ¤æ€§ã€‚